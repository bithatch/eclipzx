' palette upload and cycling example 0.1
' NextBuild emook2018

#include <nextlib.bas>

NextReg($43,$1)						' ULANext control reg
NextReg($42,63)						' ULANext number of inks : 255 127 63 41 15 7 
NextReg($14,$0)  					' global transparency value 
NextReg($40,$b)    				' $40 Palette Index Register  I assume that colours 0-7 ink 8-15 bright ink 16+ paper in ULA mode
NextReg($41,$0)  					' value of index 
NextReg($15,%00001011)  
paper 0 : ink 7 : BRIGHT 0:  border 0 : cls

' PalUpload(paletter data address eg @Label,Number of colours to upload)
 PalUpload(@Palette,0,0) ' load entire 512 bytes for 9bit 256x2 colours entries
' lets do a loop to upload the palette data from an offset to make the colours cycle a bit 
LoadBMP("spiral.bmp")
ShowLayer2(1)			' ON 
dim t as fixed 
c=0 : p = 0 
inverse 1 : OVER 1 
do 
	ex=0												' reset exit timer
	' LoadSD(filename,address,length,offset from start)
	'LoadSD("skull.scr",16384,6912,0)
	LoadSD("zxnext2.scr",16384,6912,0)

	
	for y =0 to 23 step 2
		for x=0 to 30 step 2			
			print at y,x;"  ";
			print at y+1,x;"  ";
			
			poke 22528+(cast(uinteger,y)*32)+x,c
			poke 22529+(cast(uinteger,y)*32)+x,c
			poke 22528+((cast(uinteger,y+1)*32))+x,c
			poke 22529+((cast(uinteger,y+1)*32))+x,c
	
			c=c+1
		next x
		c=c+2
	next y
	
	
	DO 
		' do a loop with a for next loop, read the palette data and upload it from an offset
		For x=0 to 63 step 2		
			pause 2
			PalUpload(@Palette+x,0,x)
		next x 
		'ex=ex+1										' increase the exit timer
	loop until ex=5							' timer hit 5 so next bit 
	
	
	'LoadSD("skull.scr",16384,6912,0)
	ex=0												' reset exit timer
' 
' 	for x=0 to 11								'slightly different text arrangment 
' 		print at x,0;ink x;over 1;"                                ";
' 	next x
' 	for x=11 to 22								'slightly different text arrangment 
' 		print at (x),0;ink x;over 1;"                                ";
' 	next x
' 
' 	DO 													' next loop
' 		For x=0 to 127 step 2		
' 			pause 2
' 			PalUpload(@Palette+x,0,0)
' 		next x 
' 		ex=ex+1
' 	loop until ex=5
	
loop 

PAUSE 0

' This is the palette data in 9 bit format
' So DEFB LSB,MSB - the MSB will be either 0 or 1, LSB will be 0-255
' We dont use all these colours but kept so we can set all the colours

' 	DEFB	255,000,255,000,218,000,218,000
' 	DEFB	182,000,182,000,146,000,146,000
' 	DEFB	109,000,109,000,073,000,073,000
' 	DEFB	037,000,037,000,011,000,011,000
Palette:
ASM


	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	224,000,196,000,168,000,136,000
	DEFB	044,000,012,000,013,000,014,000
	DEFB	043,000,135,000,167,000,199,000
	DEFB	230,000,197,000,229,000,229,000	

	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000	
	DEFB	255,000,255,000,218,000,218,000
	DEFB	182,000,182,000,146,000,146,000
	DEFB	109,000,109,000,073,000,073,000
	DEFB	037,000,037,000,000,000,000,000

end asm 

            